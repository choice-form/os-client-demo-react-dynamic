这是一个基于React的动态组件加载的online survey clinet程序,它来自于种子仓库[os-client-seed-react](./),下面说明一些规则.

## 目录结构
这里对需要关注的一些目录结构的说明
+ `config`目录中放了一些配置,配置在不同环境中的一些资源和结构的地址
+ `lang`文件夹中放了多语言的文本,初始只有中文和英文.
+ `src`文件夹是项目代码
  + `app` 是主程序代码,答题端初始会加载这个程序,但是各个节点的组件还没加载
  + `plugin` 是动态加载的组件,开始答题时主程序会动态按需仅仅加载当前问卷需要用的组件.
    + `standards`目录中的是按节点类型标准划分的组件,进去第一层已经为每个类型的节点创建好的文件夹,这些文件夹名字是固定的,不能更改,在第二层,每个节点文件夹中已经实现了一个`basic`风格的组件,这个`basic`风格的组件是必须实现的.不能删除,除此之外,你能在第二层中`basic`的同级中为这个节点类型添加更多的风格,名字可以任意取.只有`basic`是名字不能变且必须存在的,其他风格的没有要求.
    + `partials`用于放置了比节点更低一级的共同组建,这里面没有限制,你可以添加任何名字和数量的组件,然后在`standards`中引用这里面的组件,如问题的头部所有题目都渲染成一样,则可以在`partials`中创建一个比如叫`node-head`的组件,然后`standards`中的节点组件在引用这个组件;同时`partials`中的某个组件也可以引用`partials`中的另一个组件.但是`partials`中的组件不能引用`standards`中的组件,
    > `plugin`目录中的引用规则:`standards`中的模块可以引用`partials`中的模块,`partials`中的模块可以引用`partials`中的模块,但是`partials`中的模块不能引用`standards`中的模块
  + `utils`目录用于放一些`app`和`plugin`中共同用到的模块
  > `app`和`plugin`是两个独立的程序,不能互相引用对方的模块,`app`可以引用`utils`,`plugin`也可以引用`utils`,反过来,`utils`不能引用`plugin`和`app`中的模块.

## 整理一下思路
+ 主程序,是放到`src/app`下面的程序,是一个完整的全段项目
+ 插件程序,是放到`src/plugin`下面的程序,是一些单独的前端组件,是要和主程序分离构建的,主程序最终会按需使用到这里面的组件,但是构建项目的时候不会构建在一起;编程时,主程序和插件程序之间的模块不能互相引用.
+ 工具程序,是放到`src/utils`下面的程序,指一些单独的模块,是主程序和插件程序都想使用的一些模块,这里面的模块可以被主程序和插件程序引用,但是不能反过来引用主程序和插件程序的模块,比如我们现在就在其中有一个多语言翻译模块,
+ 插件程序内部
 + 标准入口插件,在`src/plugin/standards`文件夹下,每个节点有一个文件夹,这些文件夹名字固定,在这些文件夹下,创建多个任意名字的文件夹,就为该节点创建了多个渲染风格,每个文件下必须是一本`index.tsx`作为组件文件,如`src/plugin/standards/choice/basic/index.tsx`和`src/plugin/standards/choice/advanced/index.tsx`这两个文件,就会选择题创建了`基础`和`高级`两种渲染风格,在设计端选中选择题后,节点右侧的布局设置中,就可以下拉选择使用`basic`或`advanced`风格渲染.
 + 非标准入口插件,在`src/plugin/partials`文件夹下,可以任意自定义目录和文件名,和`standards`中不一样,这里面对文件夹命名没有要求,但是组件文件仍然得交index.tsx,如果是非组件模块则文件名字不限制.一般这里面的组件或模块会在不同的标准入口组件里面都会被使用

 + 所有的插件组件都必须使用export default导出;

## 引用关系限制图
箭头方向代表可引用的方向
+ app <=> app => utils <=> utils
+ plugin/standards => utils <=> utils
+ plugin/standards => plugin/partials <=> plugin/partials
+ plugin/partials <=> plugin/partials => utils <=> utils

如果没有遵循以上的规则的应用关系,则构建时会报错.



## 自定义设置
从种子仓库为模板生成仓库后,需要自定义一些配置,再进行开发
+ 应用程序名称:需要在src/app/app.tsx中的Core.setup方法的参数中设置clientName属性,这个名字需要和是设计端中选择答题渲染程序中的名字一样,
+ 构建配置:build.json
```javascript
{
  devPort: ''// 本地开发是的服务启动端口
  assetsPath: { // 资源将会被放到的地址,相当于构建后的dist目录的地址
    local: '' // 本地资源地址
    staging: '' // 测试环境资源地址
    prod: '' // 正式环境资源地址
  }
  cdnFolder: '' // cdn资源会被放到dist之下的某一个目录
}
```
  

需要在build.json中更改地址,一般单独分离出的组件会被发布到我们的cdn上,这里设置后新的仓库组件会发布到的cdn的地址.



## 开始编写
+ 做好以上准备后就可以开发组件了
+ 通用的第三方资源在app中引入,每次都会被加载
+ 每个组件自己使用的资源在这个组件中引用,每个组件自己的样式需要按basic中的示例规则引入.
+ html模板参照index.html中的方式引入
+ 多语言直接应用utils中i18n中的T(LANG.xxxx.xxxx)方式进行翻译,可以搜索示例代码.
+ 引用主题
 + app.tsx中通过getTheme方法获取主题
 + 路由组件中通过this.props.model.theme获取主题
 + 节点组件中通过this.props.theme获取主题
 + 其他更小分支上的组件中如有要用到主题,通过路由或者节点组件将主题传进去即可.




## 对接与调试
+ 这个仓库写好以后,设计端不知道的,所以设计端不会时候用这个程序,需要到设计端对接:把之前设置的本仓库的名称和发布后的程序地址写入到设计端主题管理器的代码中.
+ 本地启动项目
+ 打开设计端,发现主题管理器面板中的答题程序选择列表中会出现刚才添加的名称
+ 在下拉列表中选择时候用本项目作为答题程序,然后打开预览窗口,能看到预览窗口中显示的就是本项目的页面.
+ 修改一些本项目的代码,预览窗口会自动刷新.
+ 在设计端中选中某个节点,右侧编辑栏中选择布局tab,在这里面可以看到渲染模板的设置,下拉列表中会展示本项目中为这个节点类型准备好的各种风格,名字和风格文件夹的名字的相同,选择不同的风格后,预览窗口会展示你选择的风格.
+ 本地开发时,如果更改了既有的风格组件,则预览窗口会自动刷新展示更改后的效果;如果为该节点添加了风格,则需要刷新设计端后,才能在风格选择列表中看到新加的风格名称.





## 补充说明
为了实现节点组件的动态按需加载,我们必须把主程序和插件程序分开,构建出来的资源也是分开的.
这样主程序初始运行起来的时候加载的东西就会很小,只有模板+路由引擎(如react,vue等),答题端核心包(os-client-core),主程序自己的代码和一些通用依赖的包,而节点组件的代码一个都还没加载

当开始渲染某些题目的时候,才会去需要渲染的某个类型的题目的某个风格的组件代码.这样的话如果问卷中只用两个题型的两个风格,则答题端从始至终就只会加载这两个组件,(当然开始和结束的组件必然是会加载的).

有了上面的机制,我们在节点类型增加,或因不同客户的需求对某个题型的展现方式发生巨大变化的时候,我们可以毫无负担的在plugin中添加新的题型组件,或者为某个题型添加新的风格组件,这样的横向扩展不再会使得答题端程序的加载包变大,使得以后的UI开放可以更自由.



